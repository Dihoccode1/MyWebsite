<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Thông tin tài khoản</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="/bootstrap-4.6.2-dist/css/bootstrap.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link rel="stylesheet" href="/assets/css/base.css" />
  </head>
  <body>
    <header class="header">
      <div class="topbar">
        <div class="container">
          <div class="topbar-right"></div>
        </div>
      </div>
    </header>

    <header class="mid-header">
      <div class="container">
        <div class="header-main">
          <div class="header-left">
            <!-- Chặn autofill & gõ dấu ok -->
            <form
              action="/search"
              method="get"
              class="search-bar"
              autocomplete="off"
            >
              <input
                type="text"
                name="query"
                placeholder="Tìm kiếm"
                autocomplete="off"
                autocapitalize="off"
                autocorrect="off"
                spellcheck="false"
                inputmode="search"
              />
              <button type="submit" aria-label="Tìm kiếm">
                <i class="fa-solid fa-magnifying-glass"></i>
              </button>
            </form>
          </div>

          <div class="header-center">
            <a href="/trangchu.html" class="logo">
              <img src="/assets/images/logo.jpg" alt="GENTLEMAN" />
            </a>
          </div>

          <div class="header-right">
            <a href="/giohang.html" class="cart-link">
              <i class="fa-solid fa-cart-shopping"></i>
              GIỎ HÀNG (<span class="cart-count">0</span>)
            </a>
          </div>
        </div>
      </div>
    </header>

    <nav class="main-nav">
      <ul>
        <li><a href="/trangchu.html">TRANG CHỦ</a></li>
        <li><a href="/gioithieu.html">GIỚI THIỆU</a></li>
        <li>
          <a href="/sanpham/sanpham.html" class="js-products-url">SẢN PHẨM</a>
        </li>
        <li><a href="/tintuc.html">TIN TỨC</a></li>
        <li><a href="/lienhe.html">LIÊN HỆ</a></li>
      </ul>
    </nav>

    <script>
      (function (w, d) {
        // Lấy URL trang sản phẩm từ menu (ưu tiên .js-products-url)
        function getProductsURL() {
          var a =
            d.querySelector("nav.main-nav a.js-products-url") ||
            d.querySelector('nav.main-nav a[href*="/sanpham"]');
          return a && a.getAttribute("href")
            ? a.getAttribute("href")
            : "/sanpham/sanpham.html";
        }

        var form = d.querySelector(".search-bar");
        if (!form) return;

        form.addEventListener(
          "submit",
          function (e) {
            e.preventDefault();

            var input = form.querySelector(
              'input[name="query"], input[name="q"]'
            );
            var q = ((input && input.value) || "").trim().replace(/\s+/g, " ");
            var raw = getProductsURL();

            // Dùng URL để không bị nhân đôi ?q= và giữ các param khác nếu có
            var url = new URL(raw, w.location.origin);
            if (q) url.searchParams.set("q", q);
            else url.searchParams.delete("q");

            // Điều hướng sang trang sản phẩm với ?q=
            w.location.href = url.pathname + (url.search ? url.search : "");
          },
          { passive: false }
        );
      })(window, document);
    </script>

    <script>
      (function (w, d) {
        // gọi sau khi auth sẵn sàng
        function makeWelcomeClickable() {
          // ưu tiên phần tử của header mới
          var el = d.querySelector(".welcome-user");
          if (el) {
            // đã là <a>, đảm bảo đúng href
            el.setAttribute("href", "/account/profile.html");
            return;
          }

          // các trường hợp site cũ: #welcomeName, [data-welcome-name], .js-welcome-name
          var target = d.querySelector(
            "#welcomeName, [data-welcome-name], .js-welcome-name"
          );
          if (!target) return;

          // nếu chưa phải <a>, bọc lại thành <a>
          if (target.tagName !== "A") {
            var a = d.createElement("a");
            a.href = "/account/profile.html";
            a.className = "welcome-link";
            while (target.firstChild) a.appendChild(target.firstChild);
            target.appendChild(a);
          } else {
            target.setAttribute("href", "/account/profile.html");
          }
        }

        d.addEventListener("auth:ready", makeWelcomeClickable);
        if (w.AUTH && w.AUTH.ready) makeWelcomeClickable();
      })(window, document);
    </script>

    <div class="container py-5">
      <div class="row">
        <div class="col-md-6 mx-auto">
          <div class="card">
            <div class="card-body">
              <h3 class="card-title mb-4">Thông tin tài khoản</h3>
              <div id="profileInfo">
                <p>Đang tải...</p>
              </div>
              <hr />
              <a href="/giohang.html" class="btn btn-primary"
                >Giỏ hàng của tôi</a
              >
              <a href="/account/orders.html" class="btn btn-outline-info"
                >Lịch sử mua hàng</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="site-footer">
        <div class="top-footer">
          <div class="container">
            <div class="row">
              <section class="widget-ft">
                <h4 class="title-menu">Thông tin</h4>
                <ul class="list-menu">
                  <li class="li_menu">
                    <a href="/trangchu.html">Trang chủ</a>
                  </li>
                  <li class="li_menu">
                    <a href="/gioithieu.html">Giới thiệu</a>
                  </li>
                  <li class="li_menu">
                    <a href="/sanpham/sanpham.html">Sản phẩm</a>
                  </li>
                  <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
                  <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
                </ul>
              </section>

              <section class="widget-ft">
                <h4 class="title-menu">Hỗ trợ</h4>
                <ul class="list-menu">
                  <li class="li_menu">
                    <a href="/trangchu.html">Trang chủ</a>
                  </li>
                  <li class="li_menu">
                    <a href="/gioithieu.html">Giới thiệu</a>
                  </li>
                  <li class="li_menu">
                    <a href="/sanpham/sanpham.html">Sản phẩm</a>
                  </li>
                  <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
                  <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
                </ul>
              </section>

              <section class="widget-ft">
                <h4 class="title-menu">Hướng dẫn</h4>
                <ul class="list-menu">
                  <li class="li_menu">
                    <a href="/trangchu.html">Trang chủ</a>
                  </li>
                  <li class="li_menu">
                    <a href="/gioithieu.html">Giới thiệu</a>
                  </li>
                  <li class="li_menu">
                    <a href="/sanpham/sanpham.html">Sản phẩm</a>
                  </li>
                  <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
                  <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
                </ul>
              </section>

              <section class="widget-ft">
                <h4 class="title-menu">Chính sách</h4>
                <ul class="list-menu">
                  <li class="li_menu">
                    <a href="/trangchu.html">Trang chủ</a>
                  </li>
                  <li class="li_menu">
                    <a href="/gioithieu.html">Giới thiệu</a>
                  </li>
                  <li class="li_menu">
                    <a href="/sanpham/sanpham.html">Sản phẩm</a>
                  </li>
                  <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
                  <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
                </ul>
              </section>

              <section class="wg-logo">
                <h4 class="title-menu">Liên hệ</h4>
                <ul class="contact">
                  <li>
                    <span class="txt_content_child">
                      <span
                        ><i
                          class="fa-solid fa-location-dot"
                          aria-hidden="true"
                        ></i
                      ></span>
                      140B-Tổ 3, Ấp Xóm Chùa,Tỉnh Tây Ninh
                    </span>
                  </li>
                  <li class="sdt">
                    <span
                      ><i class="fa-solid fa-phone" aria-hidden="true"></i
                    ></span>
                    <a href="tel:0338286525">0338286525</a>
                  </li>
                  <li class="sdt">
                    <span><i class="fa-solid fa-envelope"></i></span>
                    <a href="mailto:thanhloc29052006@gmail.com"
                      >thanhloc29052006@gmail.com</a
                    >
                  </li>
                </ul>
              </section>
            </div>
          </div>
        </div>

        <div class="mid-footer">
          <div class="container">
            <div class="row">
              <div class="fot_copyright">
                <span class="wsp"
                  ><span
                    >Cung cấp bởi <a href="javascript:;">Nhóm 7</a></span
                  ></span
                >
              </div>
              <nav class="fot_menu_copyright">
                <ul class="ul_menu_fot">
                  <li>
                    <a href="/trangchu.html" title="Trang chủ">Trang chủ</a>
                  </li>
                  <li>
                    <a href="/gioithieu.html" title="Giới thiệu">Giới thiệu</a>
                  </li>
                  <li>
                    <a href="/sanpham/sanpham.html" title="Sản phẩm"
                      >Sản phẩm</a
                    >
                  </li>
                  <li><a href="/tin-tuc.html" title="Tin tức">Tin tức</a></li>
                  <li><a href="/lienhe.html" title="Liên hệ">Liên hệ</a></li>
                </ul>
              </nav>
              <div class="pay_footer">
                <ul class="follow_option">
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_1.png"
                        alt="Payment"
                    /></a>
                  </li>
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_2.png"
                        alt="Payment"
                    /></a>
                  </li>
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_3.png"
                        alt="Payment"
                    /></a>
                  </li>
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_4.png"
                        alt="Payment"
                    /></a>
                  </li>
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_5.png"
                        alt="Payment"
                    /></a>
                  </li>
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_6.png"
                        alt="Payment"
                    /></a>
                  </li>
                  <li>
                    <a href="#"
                      ><img
                        src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_7.png"
                        alt="Payment"
                    /></a>
                  </li>
                </ul>
              </div>
              <a
                href="#"
                id="back-to-top"
                class="backtop"
                title="Lên đầu trang"
              >
                <i class="fa-solid fa-angle-up" aria-hidden="true"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Auth + Data + Store -->
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/auth.modal.bridge.js"></script>
    <script src="/assets/js/products.seed.js"></script>
    <script src="/assets/js/store.js"></script>
    <script src="/assets/js/ui.js"></script>

    <script>
      // ====== Lấy thông tin phụ (SĐT, địa chỉ) từ localStorage ======
      function getExtraProfile(email) {
        if (!email) return {};
        try {
          const KEY = "sv_profiles_v1";
          const allProfiles = JSON.parse(localStorage.getItem(KEY) || "{}");
          return allProfiles[(email || "").toLowerCase()] || {};
        } catch (e) {
          console.error("Lỗi khi đọc dữ liệu hồ sơ:", e);
          return {};
        }
      }

      // ====== Render thông tin tài khoản ======
      function renderProfile() {
        const info = document.getElementById("profileInfo");

        if (window.AUTH?.loggedIn && window.AUTH.user) {
          const u = window.AUTH.user;
          const extraInfo = getExtraProfile(u.email);

          info.innerHTML = `
      <dl class="row">
        <dt class="col-sm-4">Họ tên:</dt>
        <dd class="col-sm-8"><strong>${u.name || "—"}</strong></dd>

        <dt class="col-sm-4">Email:</dt>
        <dd class="col-sm-8">${u.email || "—"}</dd>

        <dt class="col-sm-4">Số điện thoại:</dt>
        <dd class="col-sm-8">${extraInfo.phone || "Chưa cập nhật"}</dd>

        <dt class="col-sm-4">Địa chỉ:</dt>
        <dd class="col-sm-8">${extraInfo.address || "Chưa cập nhật"}</dd>
      </dl>
    `;
        } else {
          info.innerHTML =
            '<p class="text-danger">Bạn chưa đăng nhập. <a href="/account/login.html">Đăng nhập ngay</a></p>';
        }
      }

      document.addEventListener("auth:ready", renderProfile);
      if (window.AUTH && window.AUTH.ready) renderProfile();
    </script>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
