<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Lịch sử đơn hàng</title>
  <link rel="stylesheet" href="/bootstrap-4.6.2-dist/css/bootstrap.css">
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<header class="header">
  <div class="topbar">
    <div class="container">
      <div class="topbar-right"></div>
    </div>
  </div>
</header>

<header class="mid-header">
  <div class="container">
    <div class="header-main">
      <div class="header-left">
        <!-- Chặn autofill & gõ dấu ok -->
        <form action="/search" method="get" class="search-bar" autocomplete="off">
          <input type="text" name="query" placeholder="Tìm kiếm"
                 autocomplete="off" autocapitalize="off" autocorrect="off"
                 spellcheck="false" inputmode="search" />
          <button type="submit" aria-label="Tìm kiếm">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </form>
      </div>

      <div class="header-center">
        <a href="/trangchu.html" class="logo">
          <img src="/assets/images/logo.jpg" alt="GENTLEMAN">
        </a>
      </div>

      <div class="header-right">
        <a href="/giohang.html" class="cart-link">
          <i class="fa-solid fa-cart-shopping"></i>
          GIỎ HÀNG (<span class="cart-count">0</span>)
        </a>
      </div>
    </div>
  </div>
</header>

<nav class="main-nav">
  <ul>
    <li><a href="/trangchu.html">TRANG CHỦ</a></li>
    <li><a href="/gioithieu.html">GIỚI THIỆU</a></li>
    <li><a href="/sanpham/sanpham.html" class="js-products-url">SẢN PHẨM</a></li>
    <li><a href="/tintuc.html">TIN TỨC</a></li>
    <li><a href="/lienhe.html">LIÊN HỆ</a></li>
  </ul>
</nav>

<script>
(function (w, d) {
  function getProductsURL() {
    var a = d.querySelector('nav.main-nav a.js-products-url')
          || d.querySelector('nav.main-nav a[href*="/sanpham"]');
    return (a && a.getAttribute('href')) ? a.getAttribute('href') : '/sanpham/sanpham.html';
  }

  var form = d.querySelector('.search-bar');
  if (!form) return;

  form.addEventListener('submit', function (e) {
    e.preventDefault();
    var input = form.querySelector('input[name="query"], input[name="q"]');
    var q = (input && input.value || '').trim().replace(/\s+/g, ' ');
    var raw = getProductsURL();
    var url = new URL(raw, w.location.origin);
    if (q) url.searchParams.set('q', q); else url.searchParams.delete('q');
    w.location.href = url.pathname + (url.search ? url.search : '');
  }, { passive: false });
})(window, document);
</script>
<script>
(function (w, d) {
  function makeWelcomeClickable() {
    var el = d.querySelector('.welcome-user');
    if (el) { el.setAttribute('href', '/account/profile.html'); return; }
    var target = d.querySelector('#welcomeName, [data-welcome-name], .js-welcome-name');
    if (!target) return;
    if (target.tagName !== 'A') {
      var a = d.createElement('a');
      a.href = '/account/profile.html';
      a.className = 'welcome-link';
      while (target.firstChild) a.appendChild(target.firstChild);
      target.appendChild(a);
    } else {
      target.setAttribute('href', '/account/profile.html');
    }
  }
  d.addEventListener('auth:ready', makeWelcomeClickable);
  if (w.AUTH && w.AUTH.ready) makeWelcomeClickable();
})();
</script>
<div class="container py-4">
  <h3 class="mb-3">Lịch sử mua hàng</h3>

  <div class="form-inline mb-3">
    <label class="mr-2">Email tài khoản</label>
    <input id="accEmail" class="form-control mr-2" style="min-width:260px" placeholder="nhập email để tra đơn">
    <button id="btnLoad" class="btn btn-secondary">Tải</button>
  </div>

  <div id="ordersWrap"></div>
</div>

<footer class="footer">
  <div class="site-footer">
    <div class="top-footer">
      <div class="container">
        <div class="row">
          <section class="widget-ft">
            <h4 class="title-menu">Thông tin</h4>
            <ul class="list-menu">
              <li class="li_menu"><a href="/trangchu.html">Trang chủ</a></li>
              <li class="li_menu"><a href="/gioithieu.html">Giới thiệu</a></li>
              <li class="li_menu"><a href="/sanpham/sanpham.html">Sản phẩm</a></li>
              <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
              <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
            </ul>
          </section>

          <section class="widget-ft">
            <h4 class="title-menu">Hỗ trợ</h4>
            <ul class="list-menu">
              <li class="li_menu"><a href="/trangchu.html">Trang chủ</a></li>
              <li class="li_menu"><a href="/gioithieu.html">Giới thiệu</a></li>
              <li class="li_menu"><a href="/sanpham/sanpham.html">Sản phẩm</a></li>
              <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
              <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
            </ul>
          </section>

          <section class="widget-ft">
            <h4 class="title-menu">Hướng dẫn</h4>
            <ul class="list-menu">
              <li class="li_menu"><a href="/trangchu.html">Trang chủ</a></li>
              <li class="li_menu"><a href="/gioithieu.html">Giới thiệu</a></li>
              <li class="li_menu"><a href="/sanpham/sanpham.html">Sản phẩm</a></li>
              <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
              <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
            </ul>
          </section>

          <section class="widget-ft">
            <h4 class="title-menu">Chính sách</h4>
            <ul class="list-menu">
              <li class="li_menu"><a href="/trangchu.html">Trang chủ</a></li>
              <li class="li_menu"><a href="/gioithieu.html">Giới thiệu</a></li>
              <li class="li_menu"><a href="/sanpham/sanpham.html">Sản phẩm</a></li>
              <li class="li_menu"><a href="/tintuc.html">Tin tức</a></li>
              <li class="li_menu"><a href="/lienhe.html">Liên hệ</a></li>
            </ul>
          </section>

          <section class="wg-logo">
            <h4 class="title-menu">Liên hệ</h4>
            <ul class="contact">
              <li>
                <span class="txt_content_child">
                  <span><i class="fa-solid fa-location-dot" aria-hidden="true"></i></span>
                  140B-Tổ 3, Ấp Xóm Chùa, Tỉnh Tây Ninh
                </span>
              </li>
              <li class="sdt">
                <span><i class="fa-solid fa-phone" aria-hidden="true"></i></span>
                <a href="tel:0338286525">0338286525</a>
              </li>
              <li class="sdt">
                <span><i class="fa-solid fa-envelope"></i></span>
                <a href="mailto:thanhloc29052006@gmail.com">thanhloc29052006@gmail.com</a>
              </li>
            </ul>
          </section>
        </div>
      </div>
    </div>

    <div class="mid-footer">
      <div class="container">
        <div class="row">
          <div class="fot_copyright">
            <span class="wsp"><span>Cung cấp bởi <a href="javascript:;">Nhóm 7</a></span></span>
          </div>
          <nav class="fot_menu_copyright">
            <ul class="ul_menu_fot">
              <li><a href="/trangchu.html" title="Trang chủ">Trang chủ</a></li>
              <li><a href="/gioithieu.html" title="Giới thiệu">Giới thiệu</a></li>
              <li><a href="/sanpham/sanpham.html" title="Sản phẩm">Sản phẩm</a></li>
              <li><a href="/tin-tuc.html" title="Tin tức">Tin tức</a></li>
              <li><a href="/lienhe.html" title="Liên hệ">Liên hệ</a></li>
            </ul>
          </nav>
          <div class="pay_footer">
            <ul class="follow_option">
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_1.png" alt="Payment"></a></li>
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_2.png" alt="Payment"></a></li>
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_3.png" alt="Payment"></a></li>
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_4.png" alt="Payment"></a></li>
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_5.png" alt="Payment"></a></li>
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_6.png" alt="Payment"></a></li>
              <li><a href="#"><img src="//bizweb.dktcdn.net/100/004/366/themes/900241/assets/pay_7.png" alt="Payment"></a></li>
            </ul>
          </div>
          <a href="#" id="back-to-top" class="backtop" title="Lên đầu trang">
            <i class="fa-solid fa-angle-up" aria-hidden="true"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Auth + Data + Store -->
    <script src="/assets/js/auth.js"></script>  
    <script src="/assets/js/auth.security.enforcer.js"></script>
<script src="/assets/js/auth.localstorage.bridge.js"></script>
<script src="/assets/js/auth.reactive.guard.v2.js"></script>
<script src="/assets/js/auth.modal.bridge.js"></script>
<script src="/assets/js/products.seed.js"></script>
<script src="/assets/js/store.js"></script>
<script src="/assets/js/ui.js"></script>

<script>
/* Lịch sử đơn hàng – localStorage demo
   - Dữ liệu đọc từ localStorage['sv_orders_v1']
   - Cấu trúc:
     {
       "email@domain.com": [
         {
           id: "DH001",
           created_at: "2025-10-31T12:00:00.000Z",
           status: "paid",
           payMethod: "COD | VNPAY | Momo",
           shipping: { fullname:"...", phone:"...", address:"...", district:"...", city:"..." },
           items: [{ id:"...", name:"...", qty:2, price:150000 }],
           subtotal: 300000, ship: 30000, total: 330000
         }
       ]
     }
*/
(function(){
  const KEY = 'sv_orders_v1';
  const $ = s => document.querySelector(s);
  const ordersWrap = $('#ordersWrap');
  const accEmail   = $('#accEmail');
  const money = n => (Number(n)||0).toLocaleString('vi-VN') + '₫';

  // Tự điền email từ hệ auth nếu có
  document.addEventListener('auth:ready', fillEmailFromAuth);
  if (window.AUTH && window.AUTH.ready) fillEmailFromAuth();

  function fillEmailFromAuth(){
    if (window.AUTH?.loggedIn && window.AUTH.user?.email) {
      accEmail.value = window.AUTH.user.email;
      load();
    }
  }

  function load(){
    const email = (accEmail.value||'').trim().toLowerCase();
    if (!email) { alert('Nhập email tài khoản'); return; }
    const db = JSON.parse(localStorage.getItem(KEY)||'{}');
    const list = Array.isArray(db[email]) ? db[email] : [];
    ordersWrap.innerHTML = list.length ? list.map(renderCard).join('') : '<div class="text-muted">Chưa có đơn hàng.</div>';
  }

  function renderCard(o){
    const date = new Date(o.created_at);
    const when = isNaN(date) ? (o.created_at||'') : date.toLocaleString('vi-VN');
    const ship = [o.shipping?.address, o.shipping?.district, o.shipping?.city]
                  .filter(Boolean).join(', ');
    const items = (o.items||[]).map(it => `
      <li class="list-group-item d-flex justify-content-between">
        <div>${escapeHtml(it.name)} <span class="text-muted">x${Number(it.qty)||0}</span></div>
        <div>${money((Number(it.price)||0) * (Number(it.qty)||0))}</div>
      </li>
    `).join('');

    return `
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Đơn ${escapeHtml(o.id||'—')}</h5>
            <span class="badge badge-info text-uppercase">${escapeHtml(o.status||'new')}</span>
          </div>
          <div class="text-muted mb-2">${escapeHtml(when)} • ${escapeHtml(o.payMethod||'')}</div>
          <div class="mb-2">
            <strong>Giao đến:</strong>
            ${escapeHtml(o.shipping?.fullname||'')} • ${escapeHtml(o.shipping?.phone||'')}<br>
            ${escapeHtml(ship)}
          </div>
          <ul class="list-group list-group-flush mb-2">${items}</ul>
          <div class="d-flex justify-content-between mt-2">
            <span>Tạm tính</span><strong>${money(o.subtotal)}</strong>
          </div>
          <div class="d-flex justify-content-between">
            <span>Phí vận chuyển</span><strong>${money(o.ship)}</strong>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <span>Tổng cộng</span><strong>${money(o.total)}</strong>
          </div>
        </div>
      </div>`;
  }

  function escapeHtml(s){
    return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // nút tải
  document.getElementById('btnLoad').addEventListener('click', load);
})();
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
